<!DOCTYPE html>
<html>
	<head>
		<title>OpenATBP - Registration</title>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script defer type="text/javascript" src="js/bootstrap.bundle.min.js"></script>

    <style>
        body {
          display: -ms-flexbox;
          display: flex;
          -ms-flex-align: center;
          align-items: center;
          padding-top: 40px;
          padding-bottom: 40px;
          background-image: url('bg3.png');
          height:100vh;
          background-size: cover;
        }
        .form-login {
          width: 100%;
          max-width: 480px;
          padding: 15px;
          margin: auto;
        }
        .form-login .checkbox {
          font-weight: 400;
        }
        .form-login .form-control {
          position: relative;
          box-sizing: border-box;
          height: auto;
          padding: 10px;
          font-size: 16px;
        }
        .form-login .form-control:focus {
          z-index: 2;
        }
        #password {
          margin-bottom: -1px;
          border-bottom-right-radius: 0;
          border-bottom-left-radius: 0;
        }
        #confirm {
          margin-bottom: 10px;
          border-top-left-radius: 0;
          border-top-right-radius: 0;
        }
      </style>
  </head>
	<body>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script defer type="text/javascript" src="js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">
    const failed = window.location.search.includes('failed');
    const exists = window.location.search.includes('exists');
    if(failed) window.alert("Registration failed!");
    else if(exists) window.alert("User already exists! Please login.");

		function blockSpecialChar(e){
			var format = /[ `!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
			return e.key != undefined ? !format.test(e.key) : !format.test(String.fromCharCode(e.charCode));
		}

    </script>

    <div class="container" style="width: 32rem;">
		<div class="card text-center">
			<form class="form-login" id="form" action="/auth/register" method="post">
          <img class="mb-4" src="favicon.ico" alt="" width="128" height="128">
          <h1 class="h3 mb-3 font-weight-normal">Register</h1>

          <input type="text" id="username" class="form-control" placeholder="Username" name="username" required autofocus onkeypress="return blockSpecialChar(event)">

          <input type="password" id="password" class="form-control mt-3 mb-0" placeholder="Password" name="password" required>
          <input type="password" id="confirm" class="form-control mt-0 mb-3" placeholder="Confirm Password" name="confirm" required>

          <label for="name1">Display Name:</label>
          <div class="input-group mb-3">

        <select class="custom-select" id="name1" name="name1" ></select>
        <select class="custom-select" id="name2" name="name2"></select>
        <select class="custom-select" id="name3" name="name3"></select>
      </div>

        <input type="text" id="forgot" class="form-control mb-3" placeholder="Secret Phrase for resetting password" name="forgot" required>
        <button class="btn btn-lg btn-primary btn-block" type="submit">Submit</button>
        <p class="mt-3 text-muted">Already have an account? <a href="/login">Login</a></p>
      </form>
    </div>
  </div>
      <script type="text/javascript">
            var names = '<%- displayNames %>';
            var nameObj = JSON.parse(names);

            //TODO: Could make this look cleaner but that is a future refactor project :P
            var text1 = "<option></option>"
            for(var name of nameObj.list1){
              text1+=`<option>${name.toUpperCase()}</option>`;
            }
            document.getElementById("name1").innerHTML=text1;
            //document.getElementById("list1").innerHTML=text1;

            var text2 = "<option></option>"
            for(var name of nameObj.list2){
              text2+=`<option>${name.toUpperCase()}</option>`;
            }
            document.getElementById("name2").innerHTML=text2;

            var text3 = "<option></option>"
            for(var name of nameObj.list3){
              text3+=`<option>${name.toUpperCase()}</option>`;
            }
            document.getElementById("name3").innerHTML=text3;
      </script>
	</body>
</html>
